<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="kn">import</span> <span class="nn">pprint</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'../data/fhir/Abe604_Veum823_e841a5e8-9ace-437b-be32-b37d006aef87.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'str'&gt;
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'../data/fhir/Abe604_Veum823_e841a5e8-9ace-437b-be32-b37d006aef87.json'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">bundle</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bundle</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'dict'&gt;
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">bundle</span><span class="p">[</span><span class="s">'entry'</span><span class="p">]:</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s">'resource'</span><span class="p">]</span>
    <span class="n">resource_type</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'resourceType'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s">'Claim'</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
        <span class="n">patient</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'patient'</span><span class="p">][</span><span class="s">'reference'</span><span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'total'</span><span class="p">][</span><span class="s">'value'</span><span class="p">]</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'total'</span><span class="p">][</span><span class="s">'currency'</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'billablePeriod'</span><span class="p">][</span><span class="s">'start'</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'billablePeriod'</span><span class="p">][</span><span class="s">'end'</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="n">patient</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>urn:uuid:df5f01e0-810b-4379-be90-bf53a6b3563d active 125.0 USD 1968-04-11T18:37:35-05:00 1968-04-11T18:52:35-05:00
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">bundle</span><span class="p">[</span><span class="s">'entry'</span><span class="p">]:</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s">'resource'</span><span class="p">]</span>
    <span class="n">resource_type</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'resourceType'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s">'Claim'</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
        <span class="n">patient</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'patient'</span><span class="p">][</span><span class="s">'reference'</span><span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'total'</span><span class="p">][</span><span class="s">'value'</span><span class="p">]</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'total'</span><span class="p">][</span><span class="s">'currency'</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s">'billablePeriod'</span><span class="p">][</span><span class="s">'start'</span><span class="p">])</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s">'billablePeriod'</span><span class="p">][</span><span class="s">'end'</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="n">patient</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">currency</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>urn:uuid:df5f01e0-810b-4379-be90-bf53a6b3563d active 125.0 USD 1968-04-11 18:37:35-05:00 1968-04-11 18:52:35-05:00
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="n">db</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite:///fhir.db'</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">claims</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'claims'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
                  <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">Integer</span><span class="p">()),</span>
                  <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'patient'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">)),</span>
                  <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'status'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">)),</span>
                  <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'total'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">Float</span><span class="p">()),</span>
                  <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'currency'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">)),</span>
                  <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'start'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">DateTime</span><span class="p">()),</span>
                  <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'end'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">DateTime</span><span class="p">()))</span>

<span class="n">metadata</span><span class="p">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="c1">#Creates the table
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">claims</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['id', 'patient', 'status', 'total', 'currency', 'start', 'end']
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">bundle</span><span class="p">[</span><span class="s">'entry'</span><span class="p">]:</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s">'resource'</span><span class="p">]</span>
    <span class="n">resource_type</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'resourceType'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="s">'Claim'</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'id'</span><span class="p">]</span>
        <span class="n">patient</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'patient'</span><span class="p">][</span><span class="s">'reference'</span><span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'total'</span><span class="p">][</span><span class="s">'value'</span><span class="p">]</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="s">'total'</span><span class="p">][</span><span class="s">'currency'</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s">'billablePeriod'</span><span class="p">][</span><span class="s">'start'</span><span class="p">])</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s">'billablePeriod'</span><span class="p">][</span><span class="s">'end'</span><span class="p">])</span>        
        <span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">claims</span><span class="p">).</span><span class="n">values</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> 
                                         <span class="n">patient</span><span class="o">=</span><span class="n">patient</span><span class="p">,</span>
                                         <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
                                         <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
                                         <span class="n">currency</span><span class="o">=</span><span class="n">currency</span><span class="p">,</span>
                                         <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                                         <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>

        <span class="n">result_proxy</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stmt</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">claims</span><span class="p">])</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>patient</th>
      <th>status</th>
      <th>total</th>
      <th>currency</th>
      <th>start</th>
      <th>end</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>b16bf2ad-9084-4764-b029-83aa5e40edaa</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>255.0</td>
      <td>USD</td>
      <td>1988-04-23 13:35:04</td>
      <td>1988-04-23 13:50:04</td>
    </tr>
    <tr>
      <th>1</th>
      <td>b16bf2ad-9084-4764-b029-83aa5e40edaa</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>255.0</td>
      <td>USD</td>
      <td>1988-04-23 13:35:04</td>
      <td>1988-04-23 13:50:04</td>
    </tr>
    <tr>
      <th>2</th>
      <td>722b5412-303f-4c19-8065-b40c8c3cff26</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>125.0</td>
      <td>USD</td>
      <td>1988-04-23 13:35:04</td>
      <td>1988-04-23 13:50:04</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6305265e-1ffb-48af-bc29-404eafe9e426</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>125.0</td>
      <td>USD</td>
      <td>1991-08-03 13:35:04</td>
      <td>1991-08-03 13:50:04</td>
    </tr>
    <tr>
      <th>4</th>
      <td>e6f0f9cb-0655-4e3f-bbb3-b11fe034618a</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>125.0</td>
      <td>USD</td>
      <td>1997-08-09 13:35:04</td>
      <td>1997-08-09 14:50:04</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stmt</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">claims</span><span class="p">])</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>patient</th>
      <th>status</th>
      <th>total</th>
      <th>currency</th>
      <th>start</th>
      <th>end</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>b16bf2ad-9084-4764-b029-83aa5e40edaa</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>255.0</td>
      <td>USD</td>
      <td>1988-04-23 13:35:04</td>
      <td>1988-04-23 13:50:04</td>
    </tr>
    <tr>
      <th>1</th>
      <td>b16bf2ad-9084-4764-b029-83aa5e40edaa</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>255.0</td>
      <td>USD</td>
      <td>1988-04-23 13:35:04</td>
      <td>1988-04-23 13:50:04</td>
    </tr>
    <tr>
      <th>2</th>
      <td>722b5412-303f-4c19-8065-b40c8c3cff26</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>125.0</td>
      <td>USD</td>
      <td>1988-04-23 13:35:04</td>
      <td>1988-04-23 13:50:04</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6305265e-1ffb-48af-bc29-404eafe9e426</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>125.0</td>
      <td>USD</td>
      <td>1991-08-03 13:35:04</td>
      <td>1991-08-03 13:50:04</td>
    </tr>
    <tr>
      <th>4</th>
      <td>e6f0f9cb-0655-4e3f-bbb3-b11fe034618a</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>125.0</td>
      <td>USD</td>
      <td>1997-08-09 13:35:04</td>
      <td>1997-08-09 14:50:04</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stmt</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">claims</span><span class="p">]).</span><span class="n">where</span><span class="p">(</span><span class="n">claims</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">total</span> <span class="o">&gt;=</span> <span class="mf">25000.0</span><span class="p">).</span><span class="n">order_by</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">desc</span><span class="p">(</span><span class="n">claims</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">total</span><span class="p">))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>patient</th>
      <th>status</th>
      <th>total</th>
      <th>currency</th>
      <th>start</th>
      <th>end</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16f8da2a-322e-47ca-bc82-8b66843858f9</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>74670.12</td>
      <td>USD</td>
      <td>2015-12-26 12:35:04</td>
      <td>2015-12-26 17:50:04</td>
    </tr>
    <tr>
      <th>1</th>
      <td>16f8da2a-322e-47ca-bc82-8b66843858f9</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>74670.12</td>
      <td>USD</td>
      <td>2015-12-26 12:35:04</td>
      <td>2015-12-26 17:50:04</td>
    </tr>
    <tr>
      <th>2</th>
      <td>16f8da2a-322e-47ca-bc82-8b66843858f9</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>74670.12</td>
      <td>USD</td>
      <td>2015-12-26 12:35:04</td>
      <td>2015-12-26 17:50:04</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16f8da2a-322e-47ca-bc82-8b66843858f9</td>
      <td>urn:uuid:ab8f33ad-54b4-4ee0-acd7-a14918459c3d</td>
      <td>active</td>
      <td>74670.12</td>
      <td>USD</td>
      <td>2015-12-26 12:35:04</td>
      <td>2015-12-26 17:50:04</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stmt</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">db</span><span class="p">.</span><span class="n">func</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">claims</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">total</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">'total claims'</span><span class="p">),</span>
                  <span class="n">db</span><span class="p">.</span><span class="n">func</span><span class="p">.</span><span class="n">avg</span><span class="p">(</span><span class="n">claims</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">total</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">'average claim'</span><span class="p">)])</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">).</span><span class="n">head</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total claims</th>
      <th>average claim</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1538768.09</td>
      <td>3153.213299</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>
