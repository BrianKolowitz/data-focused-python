<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>03 - Getting Data from a Database - Data Focused Python</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-139655036-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-139655036-1'); </script> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>03 - Getting Data from a Database | Data Focused Python</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="03 - Getting Data from a Database" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/03%20-%20Getting%20Data%20from%20a%20Database.html" /> <meta property="og:url" content="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/03%20-%20Getting%20Data%20from%20a%20Database.html" /> <meta property="og:site_name" content="Data Focused Python" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="03 - Getting Data from a Database" /> <script type="application/ld+json"> {"headline":"03 - Getting Data from a Database","url":"http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/03%20-%20Getting%20Data%20from%20a%20Database.html","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Data Focused Python </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Data Focused Python</a></li><li class="nav-list-item"><a href="http://localhost:4000/assignments" class="nav-list-link">Assignments</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/lectures" class="nav-list-link">Lectures</a><ul class="nav-list "><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data.html" class="nav-list-link">Week 01 - Language basics, Generating Data, Storing Data</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/00%20-%20Getting%20Started.html" class="nav-list-link">00 - Getting Started</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/01.a%20-%20Terminal%20Application.html" class="nav-list-link">01.a - Terminal Application</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/01.b%20-%20Argparse.html" class="nav-list-link">01.b - Argparse</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/02.a%20-%20Generating%20Synthetic%20Healthcare%20Data.html" class="nav-list-link">02.a - Generating Synthetic Healthcare Data</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/02.b%20-%20Generating%20Other%20Synthetic%20Data.html" class="nav-list-link">02.b - Generating Other Synthetic Data</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/02.c%20-%20Using%20Synthea.html" class="nav-list-link">02.c - Using Synthea</a> </li><li class="nav-list-item active"> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/03%20-%20Getting%20Data%20from%20a%20Database.html" class="nav-list-link active">03 - Getting Data from a Database</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/04%20-%20FHIR%20SQL.html" class="nav-list-link">04 - FHIR SQL</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/04%20-%20Python%20Testing.html" class="nav-list-link">04 - Python Testing</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data/05%20-%20Start%20a%20process%20in%20Python.html" class="nav-list-link">05 - Start a process in Python</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests.html" class="nav-list-link">Week 02 - Processing files, Making Web Requests</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/01.a%20-%20File%20Processing.html" class="nav-list-link">01.a - File Processing</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/01.b%20-%20CSV%20Files.html" class="nav-list-link">01.b - CSV Files</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/01.c%20-%20JSON%20Files.html" class="nav-list-link">01.c - JSON Files</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/01.d%20-%20XML%20Files.html" class="nav-list-link">01.d - XML Files</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/02.a%20-%20Python%20Classes.html" class="nav-list-link">02.a - Python Classes</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/02.b%20-%20Python%20Modules%20and%20Packages.html" class="nav-list-link">02.b - Python Modules and Packages</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/03%20-%20Using%20fhirclient%20to%20parse%20Healthcare%20Data.html" class="nav-list-link">03 - Using fhirclient to parse Healthcare Data</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/04%20-%20Reading%20synthea%20data.html" class="nav-list-link">04 - Reading synthea data</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2002%20-%20Processing%20files,%20Making%20Web%20Requests/05%20-%20Getting%20Data%20from%20Web%20APIs.html" class="nav-list-link">05 - Getting Data from Web APIs</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators.html" class="nav-list-link">Week 03 - Functions, Loops, Comprehensions and Generators</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators/01.a%20-%20Python%20Functions.html" class="nav-list-link">01.a - Python Functions</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators/01.b%20-%20Python%20Tuples.html" class="nav-list-link">01.b - Python Tuples</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators/01.c%20-%20Loops.html" class="nav-list-link">01.c - Loops</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators/02%20-%20Lists%20and%20List%20Comprehensions.html" class="nav-list-link">02 - Lists and List Comprehensions</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators/03%20-%20Sets%20and%20Set%20Comprehensions.html" class="nav-list-link">03 - Sets and Set Comprehensions</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators/04.a%20-%20Dictionaries.html" class="nav-list-link">04.a - Dictionaries</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators/04.b%20-%20Dictionary%20Comprehensions.html" class="nav-list-link">04.b - Dictionary Comprehensions</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2003%20-%20Functions,%20Loops,%20Comprehensions%20and%20Generators/05%20-%20Python%20Generators.html" class="nav-list-link">05 - Python Generators</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/lectures/Week%2004%20-%20Data%20Processing%20and%20Visualization%20Part%201.html" class="nav-list-link">Week 04 - Data Processing and Visualization Part 1</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2004%20-%20Data%20Processing%20and%20Visualization%20Part%201/01.a%20-%20Cleaning%20and%20Transforming%20Data.html" class="nav-list-link">01.a - Cleaning and Transforming Data</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2004%20-%20Data%20Processing%20and%20Visualization%20Part%201/01.b%20-%20Grouping%20Data.html" class="nav-list-link">01.b - Grouping Data</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2004%20-%20Data%20Processing%20and%20Visualization%20Part%201/01.c%20-%20Descriptive%20Statistics.html" class="nav-list-link">01.c - Descriptive Statistics</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2004%20-%20Data%20Processing%20and%20Visualization%20Part%201/02%20-%20Basic%20Medical%20Data%20Visualization.html" class="nav-list-link">02 - Basic Medical Data Visualization</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2004%20-%20Data%20Processing%20and%20Visualization%20Part%201/03.a%20-%20NumPy%20Introduction.html" class="nav-list-link">03.a - NumPy Introduction</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2004%20-%20Data%20Processing%20and%20Visualization%20Part%201/03.b%20-%20NumPy%20Data%20analysis.html" class="nav-list-link">03.b - NumPy Data analysis</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/lectures/Week%2005%20-%20Data%20Processing%20and%20Visualization%20Part%202.html" class="nav-list-link">Week 05 - Data Processing and Visualization Part 2</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2005%20-%20Data%20Processing%20and%20Visualization%20Part%202/00%20-%20Additional%20Links.html" class="nav-list-link">00 - Additional Links</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2005%20-%20Data%20Processing%20and%20Visualization%20Part%202/01%20-%20Pandas%20Introduction.html" class="nav-list-link">01 - Pandas Introduction</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2005%20-%20Data%20Processing%20and%20Visualization%20Part%202/02.a%20-%20Pandas%20Data%20analysis%20Part%201.html" class="nav-list-link">02.a - Pandas Data analysis Part 1</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2005%20-%20Data%20Processing%20and%20Visualization%20Part%202/02.b%20-%20Pandas%20Data%20analysis%20Part%202.html" class="nav-list-link">02.b - Pandas Data analysis Part 2</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2005%20-%20Data%20Processing%20and%20Visualization%20Part%202/03%20-%20Matplotlib%20Tutorial%20Python%20Plotting.html" class="nav-list-link">03 - Matplotlib Tutorial Python Plotting</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2005%20-%20Data%20Processing%20and%20Visualization%20Part%202/04%20-%20The%20Ultimate%20Python%20Seaborn%20Tutorial.html" class="nav-list-link">04 - The Ultimate Python Seaborn Tutorial</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/lectures/Week%2006%20-%20Web%20Scraping.html" class="nav-list-link">Week 06 - Web Scraping</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2006%20-%20Web%20Scraping/01.%20Introduction%20to%20Web%20Scraping.html" class="nav-list-link">01. Introduction to Web Scraping</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2006%20-%20Web%20Scraping/02.%20CSS%20Selectors.html" class="nav-list-link">02. CSS Selectors</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2006%20-%20Web%20Scraping/03.a%20Web%20Scraping%20with%20Beautiful%20Soup.html" class="nav-list-link">03.a Web Scraping with Beautiful Soup</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2006%20-%20Web%20Scraping/03.b%20Web%20Scraping%20Using%20Selenium.html" class="nav-list-link">03.b Web Scraping Using Selenium</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2006%20-%20Web%20Scraping/03.c%20Web%20scraping%20with%20Scrapy.html" class="nav-list-link">03.c Web scraping with Scrapy</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2006%20-%20Web%20Scraping/04.a%20-%20More%20Web%20Scraping%20with%20BeautifulSoup.html" class="nav-list-link">04.a - More Web Scraping with BeautifulSoup</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/lectures/Week%2006%20-%20Web%20Scraping/04.b%20-%20Even%20More%20Web%20Scraping%20with%20BeautifulSoup.html" class="nav-list-link">04.b - Even More Web Scraping with BeautifulSoup</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/resources" class="nav-list-link">Resources</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Data Focused Python" aria-label="Search Data Focused Python" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/BrianKolowitz/data-focused-python" class="site-button" > Code </a> </li> <li class="aux-nav-list-item"> <a href="/data-focused-python/about.html" class="site-button" > About </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/lectures">Lectures</a></li> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/lectures/Week%2001%20-%20Language%20basics,%20Generating%20Data,%20Storing%20Data.html">Week 01 - Language basics, Generating Data, Storing Data</a></li> <li class="breadcrumb-nav-list-item"><span>03 - Getting Data from a Database</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="sqlalchemypython-tutorial"> <a href="#sqlalchemypython-tutorial" class="anchor-heading" aria-labelledby="sqlalchemypython-tutorial"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQLAlchemy — Python Tutorial </h1> <p><a href="https://towardsdatascience.com/sqlalchemy-python-tutorial-79a577141a91">Source</a></p> <p>Other References</p> <ul> <li><a href="https://www.fullstackpython.com/object-relational-mappers-orms.html">What are Object Relational Mappers (ORMs)</a></li> <li><a href="https://leportella.com/english/2019/01/10/sqlalchemy-basics-tutorial.html">SQLAlchemy Basics</a></li> </ul> <p>We often encounter data as Relational Databases. To work with them we generally would need to write raw SQL queries, pass them to the database engine and parse the returned results as a normal array of records.</p> <p>SQLAlchemy provides a nice “Pythonic” way of interacting with databases. So rather than dealing with the differences between specific dialects of traditional SQL such as MySQL or PostgreSQL or Oracle, you can leverage the Pythonic framework of SQLAlchemy to streamline your workflow and more efficiently query your data.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Installing The Package
</span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">sqlalchemy</span>
</code></pre></div></div> <h2 id="connecting-to-a-database"> <a href="#connecting-to-a-database" class="anchor-heading" aria-labelledby="connecting-to-a-database"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Connecting to a database </h2> <p>To start interacting with the database we first we need to establish a connection.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="n">db</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s">'dialect+driver://user:pass@host:port/db'</span><span class="p">)</span>
</code></pre></div></div> <h3 id="database-connection-examples"> <a href="#database-connection-examples" class="anchor-heading" aria-labelledby="database-connection-examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Database connection examples </h3> <p><a href="https://docs.sqlalchemy.org/en/13/core/engines.html#postgresql">Source</a></p> <h4 id="postgresql"> <a href="#postgresql" class="anchor-heading" aria-labelledby="postgresql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PostgreSQL </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># default
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'postgresql://scott:tiger@localhost/mydatabase'</span><span class="p">)</span>

<span class="c1"># psycopg2
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'postgresql+psycopg2://scott:tiger@localhost/mydatabase'</span><span class="p">)</span>

<span class="c1"># pg8000
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'postgresql+pg8000://scott:tiger@localhost/mydatabase'</span><span class="p">)</span>
</code></pre></div></div> <h4 id="mysql"> <a href="#mysql" class="anchor-heading" aria-labelledby="mysql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MySQL </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># default
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'mysql://scott:tiger@localhost/foo'</span><span class="p">)</span>

<span class="c1"># mysqlclient (a maintained fork of MySQL-Python)
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'mysql+mysqldb://scott:tiger@localhost/foo'</span><span class="p">)</span>

<span class="c1"># PyMySQL
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'mysql+pymysql://scott:tiger@localhost/foo'</span><span class="p">)</span>
</code></pre></div></div> <h4 id="oracle"> <a href="#oracle" class="anchor-heading" aria-labelledby="oracle"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Oracle </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'oracle://scott:tiger@127.0.0.1:1521/sidname'</span><span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'oracle+cx_oracle://scott:tiger@tnsname'</span><span class="p">)</span>
</code></pre></div></div> <h4 id="microsoft-sql-server"> <a href="#microsoft-sql-server" class="anchor-heading" aria-labelledby="microsoft-sql-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Microsoft SQL Server </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pyodbc
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'mssql+pyodbc://scott:tiger@mydsn'</span><span class="p">)</span>

<span class="c1"># pymssql
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'mssql+pymssql://scott:tiger@hostname:port/dbname'</span><span class="p">)</span>
</code></pre></div></div> <h4 id="sqlite"> <a href="#sqlite" class="anchor-heading" aria-labelledby="sqlite"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQLite </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># sqlite://&lt;nohostname&gt;/&lt;path&gt;
# where &lt;path&gt; is relative:
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite:///foo.db'</span><span class="p">)</span>

<span class="c1"># Unix/Mac - 4 initial slashes in total
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite:////absolute/path/to/foo.db'</span><span class="p">)</span>

<span class="c1"># Windows
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite:///C:</span><span class="se">\\</span><span class="s">path</span><span class="se">\\</span><span class="s">to</span><span class="se">\\</span><span class="s">foo.db'</span><span class="p">)</span>

<span class="c1"># Windows alternative using raw string
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="sa">r</span><span class="s">'sqlite:///C:\path\to\foo.db'</span><span class="p">)</span>

<span class="c1"># To use a SQLite :memory: database, specify an empty URL:
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite://'</span><span class="p">)</span>
</code></pre></div></div> <h2 id="viewing-table-details"> <a href="#viewing-table-details" class="anchor-heading" aria-labelledby="viewing-table-details"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Viewing Table Details </h2> <p>SQLAlchemy can be used to automatically load tables from a database using something called reflection. Reflection is the process of reading the database and building the metadata based on that information.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="n">db</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite:///census.db'</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>
<span class="n">census</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'census'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Print the column names
</span><span class="k">print</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['state', 'sex', 'age', 'pop2000', 'pop2008']
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Print full table metadata
</span><span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">metadata</span><span class="p">.</span><span class="n">tables</span><span class="p">[</span><span class="s">'census'</span><span class="p">]))</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Table('census', MetaData(), Column('state', VARCHAR(length=30), table=&lt;census&gt;), Column('sex', VARCHAR(length=1), table=&lt;census&gt;), Column('age', INTEGER(), table=&lt;census&gt;), Column('pop2000', INTEGER(), table=&lt;census&gt;), Column('pop2008', INTEGER(), table=&lt;census&gt;), schema=None)
</code></pre></div></div> <h2 id="querying"> <a href="#querying" class="anchor-heading" aria-labelledby="querying"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Querying </h2> <p><code class="language-plaintext highlighter-rouge">Table</code> and <code class="language-plaintext highlighter-rouge">MetaData</code> have already been imported. The metadata is available as <code class="language-plaintext highlighter-rouge">metadata</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sqlalchemy</span> <span class="k">as</span> <span class="n">db</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite:///census.db'</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>
<span class="n">census</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'census'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Equivalent to 'SELECT * FROM census'
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">])</span>
</code></pre></div></div> <p><strong>ResultProxy</strong>: The object returned by the <code class="language-plaintext highlighter-rouge">.execute()</code> method. It can be used in a variety of ways to get the data returned by the query.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ResultProxy</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></div> <p><strong>ResultSet</strong>: The actual data asked for in the query when using a fetch method such as <code class="language-plaintext highlighter-rouge">.fetchall()</code> on a ResultProxy.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ResultSet</span> <span class="o">=</span> <span class="n">ResultProxy</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ResultSet</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[('Illinois', 'M', 0, 89600, 95012),
 ('Illinois', 'M', 1, 88445, 91829),
 ('Illinois', 'M', 2, 88729, 89547)]
</code></pre></div></div> <h3 id="dealing-with-large-resultset"> <a href="#dealing-with-large-resultset" class="anchor-heading" aria-labelledby="dealing-with-large-resultset"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dealing with Large ResultSet </h3> <p>We use <code class="language-plaintext highlighter-rouge">.fetchmany()</code> to load optimal no of rows and overcome memory issues in case of large datasets.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ResultProxy</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="c1"># ResultSet = ResultProxy.fetchall()
</span><span class="n">num_to_fetch</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">partial_results</span> <span class="o">=</span> <span class="n">ResultProxy</span><span class="p">.</span><span class="n">fetchmany</span><span class="p">(</span><span class="n">num_to_fetch</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_to_fetch</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">partial_results</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ResultProxy</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>('Illinois', 'M', 0, 89600, 95012)
('Illinois', 'M', 1, 88445, 91829)
('Illinois', 'M', 2, 88729, 89547)
</code></pre></div></div> <h3 id="convert-to-dataframe"> <a href="#convert-to-dataframe" class="anchor-heading" aria-labelledby="convert-to-dataframe"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Convert to DataFrame </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ResultSet</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">ResultSet</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>state</th> <th>sex</th> <th>age</th> <th>pop2000</th> <th>pop2008</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>Illinois</td> <td>M</td> <td>0</td> <td>89600</td> <td>95012</td> </tr> <tr> <th>1</th> <td>Illinois</td> <td>M</td> <td>1</td> <td>88445</td> <td>91829</td> </tr> <tr> <th>2</th> <td>Illinois</td> <td>M</td> <td>2</td> <td>88729</td> <td>89547</td> </tr> <tr> <th>3</th> <td>Illinois</td> <td>M</td> <td>3</td> <td>88868</td> <td>90037</td> </tr> <tr> <th>4</th> <td>Illinois</td> <td>M</td> <td>4</td> <td>91947</td> <td>91111</td> </tr> </tbody> </table></div> </div> <h2 id="filtering-data"> <a href="#filtering-data" class="anchor-heading" aria-labelledby="filtering-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Filtering data </h2> <p>Lets see some examples of raw SQLite Queries and queries using SQLAlchemy.</p> <h3 id="where"> <a href="#where" class="anchor-heading" aria-labelledby="where"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> where </h3> <p><strong>SQL</strong></p><pre><code class="language-SQL">SELECT * FROM census 
WHERE sex = F
</code></pre><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># SQLAlchemy
</span><span class="n">sql</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">]).</span><span class="n">where</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s">'F'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT census.state, census.sex, census.age, census.pop2000, census.pop2008 
FROM census 
WHERE census.sex = :sex_1
</code></pre></div></div> <h3 id="in"> <a href="#in" class="anchor-heading" aria-labelledby="in"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> in </h3> <p><strong>SQL</strong></p><pre><code class="language-SQL">SELECT state, sex
FROM census
WHERE state IN (Texas, New York)
</code></pre><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># SQLAlchemy
</span><span class="n">sql</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">state</span><span class="p">,</span> <span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">sex</span><span class="p">])</span> \
    <span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="n">in_</span><span class="p">([</span><span class="s">'Texas'</span><span class="p">,</span> <span class="s">'New York'</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT census.state, census.sex 
FROM census 
WHERE census.state IN ([POSTCOMPILE_state_1])
</code></pre></div></div> <h3 id="and-or-not"> <a href="#and-or-not" class="anchor-heading" aria-labelledby="and-or-not"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> and, or, not </h3> <p><strong>SQL</strong></p><pre><code class="language-SQL">SELECT * FROM census
WHERE state = 'California' AND NOT sex = 'M'
</code></pre><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># SQLAlchemy
</span><span class="n">sql</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">])</span> \
    <span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">and_</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">'California'</span><span class="p">,</span> 
                   <span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">sex</span> <span class="o">!=</span> <span class="s">'M'</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT census.state, census.sex, census.age, census.pop2000, census.pop2008 
FROM census 
WHERE census.state = :state_1 AND census.sex != :sex_1
</code></pre></div></div> <h3 id="order-by"> <a href="#order-by" class="anchor-heading" aria-labelledby="order-by"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> order by </h3> <p><strong>SQL</strong></p><pre><code class="language-SQL">SELECT * FROM census
ORDER BY State DESC, pop2000
</code></pre><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># SQLAlchemy
</span><span class="n">sql</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">]).</span><span class="n">order_by</span><span class="p">(</span>
        <span class="n">db</span><span class="p">.</span><span class="n">desc</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">state</span><span class="p">),</span> 
        <span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">pop2000</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT census.state, census.sex, census.age, census.pop2000, census.pop2008 
FROM census ORDER BY census.state DESC, census.pop2000
</code></pre></div></div> <h3 id="functions"> <a href="#functions" class="anchor-heading" aria-labelledby="functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> functions </h3> <p>other functions include <code class="language-plaintext highlighter-rouge">avg</code>, <code class="language-plaintext highlighter-rouge">count</code>, <code class="language-plaintext highlighter-rouge">min</code>, <code class="language-plaintext highlighter-rouge">max</code></p> <p><strong>SQL</strong></p><pre><code class="language-SQL">SELECT SUM(pop2008)
FROM census
</code></pre><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># SQLAlchemy
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">db</span><span class="p">.</span><span class="n">func</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">pop2008</span><span class="p">)])</span>
<span class="n">ResultSet</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ResultSet</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>0</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>302876613</td> </tr> </tbody> </table></div> </div> <h3 id="group-by"> <a href="#group-by" class="anchor-heading" aria-labelledby="group-by"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> group by </h3> <p><strong>SQL</strong></p><pre><code class="language-SQL">SELECT SUM(pop2008) as pop2008, sex
FROM census
GROUP BY sex
</code></pre><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># SQLAlchemy
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">db</span><span class="p">.</span><span class="n">func</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">pop2008</span><span class="p">).</span><span class="n">label</span><span class="p">(</span><span class="s">'pop2008'</span><span class="p">),</span> 
           <span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">sex</span><span class="p">]).</span><span class="n">group_by</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">sex</span><span class="p">)</span>
<span class="n">ResultSet</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ResultSet</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>0</th> <th>1</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>153959198</td> <td>F</td> </tr> <tr> <th>1</th> <td>148917415</td> <td>M</td> </tr> </tbody> </table></div> </div> <h3 id="distinct"> <a href="#distinct" class="anchor-heading" aria-labelledby="distinct"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> distinct </h3> <p><strong>SQL</strong></p><pre><code class="language-SQL">SELECT DISTINCT state
FROM census
</code></pre><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># SQLAlchemy
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="n">distinct</span><span class="p">()])</span>
<span class="n">ResultSet</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ResultSet</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>0</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>Illinois</td> </tr> <tr> <th>1</th> <td>New Jersey</td> </tr> <tr> <th>2</th> <td>District of Columbia</td> </tr> <tr> <th>3</th> <td>North Dakota</td> </tr> <tr> <th>4</th> <td>Florida</td> </tr> <tr> <th>5</th> <td>Maryland</td> </tr> <tr> <th>6</th> <td>Idaho</td> </tr> <tr> <th>7</th> <td>Massachusetts</td> </tr> <tr> <th>8</th> <td>Oregon</td> </tr> <tr> <th>9</th> <td>Nevada</td> </tr> <tr> <th>10</th> <td>Michigan</td> </tr> <tr> <th>11</th> <td>Wisconsin</td> </tr> <tr> <th>12</th> <td>Missouri</td> </tr> <tr> <th>13</th> <td>Washington</td> </tr> <tr> <th>14</th> <td>North Carolina</td> </tr> <tr> <th>15</th> <td>Arizona</td> </tr> <tr> <th>16</th> <td>Arkansas</td> </tr> <tr> <th>17</th> <td>Colorado</td> </tr> <tr> <th>18</th> <td>Indiana</td> </tr> <tr> <th>19</th> <td>Pennsylvania</td> </tr> <tr> <th>20</th> <td>Hawaii</td> </tr> <tr> <th>21</th> <td>Kansas</td> </tr> <tr> <th>22</th> <td>Louisiana</td> </tr> <tr> <th>23</th> <td>Alabama</td> </tr> <tr> <th>24</th> <td>Minnesota</td> </tr> <tr> <th>25</th> <td>South Dakota</td> </tr> <tr> <th>26</th> <td>New York</td> </tr> <tr> <th>27</th> <td>California</td> </tr> <tr> <th>28</th> <td>Connecticut</td> </tr> <tr> <th>29</th> <td>Ohio</td> </tr> <tr> <th>30</th> <td>Rhode Island</td> </tr> <tr> <th>31</th> <td>Georgia</td> </tr> <tr> <th>32</th> <td>South Carolina</td> </tr> <tr> <th>33</th> <td>Alaska</td> </tr> <tr> <th>34</th> <td>Delaware</td> </tr> <tr> <th>35</th> <td>Tennessee</td> </tr> <tr> <th>36</th> <td>Vermont</td> </tr> <tr> <th>37</th> <td>Montana</td> </tr> <tr> <th>38</th> <td>Kentucky</td> </tr> <tr> <th>39</th> <td>Utah</td> </tr> <tr> <th>40</th> <td>Nebraska</td> </tr> <tr> <th>41</th> <td>West Virginia</td> </tr> <tr> <th>42</th> <td>Iowa</td> </tr> <tr> <th>43</th> <td>Wyoming</td> </tr> <tr> <th>44</th> <td>Maine</td> </tr> <tr> <th>45</th> <td>New Hampshire</td> </tr> <tr> <th>46</th> <td>Mississippi</td> </tr> <tr> <th>47</th> <td>Oklahoma</td> </tr> <tr> <th>48</th> <td>New Mexico</td> </tr> <tr> <th>49</th> <td>Virginia</td> </tr> <tr> <th>50</th> <td>Texas</td> </tr> </tbody> </table></div> </div> <h3 id="case--cast"> <a href="#case--cast" class="anchor-heading" aria-labelledby="case--cast"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> case &amp; cast </h3> <p>The <code class="language-plaintext highlighter-rouge">case()</code> expression accepts a list of conditions to match and the column to return if the condition matches, followed by an <code class="language-plaintext highlighter-rouge">else_</code> if none of the conditions match.</p> <p><code class="language-plaintext highlighter-rouge">cast()</code> function to convert an expression to a particular type</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite:///census.db'</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>
<span class="n">census</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'census'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">female_pop</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">func</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span>
    <span class="n">db</span><span class="p">.</span><span class="n">case</span><span class="p">([(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">sex</span> <span class="o">==</span> <span class="s">'F'</span><span class="p">,</span> <span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">pop2000</span><span class="p">)],</span>
            <span class="n">else_</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ResultSet</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">female_pop</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ResultSet</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>0</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>143534804</td> </tr> </tbody> </table></div> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total_pop</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">func</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">pop2000</span><span class="p">),</span> <span class="n">db</span><span class="p">.</span><span class="n">Float</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">female_pop</span><span class="o">/</span><span class="n">total_pop</span> <span class="o">*</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">ResultSet</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ResultSet</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>0</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>51.094674</td> </tr> </tbody> </table></div> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="n">scalar</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>51.09467432293413
</code></pre></div></div> <p>We use <code class="language-plaintext highlighter-rouge">.scalar</code> to the result when the result contains only single value</p> <h3 id="joins"> <a href="#joins" class="anchor-heading" aria-labelledby="joins"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> joins </h3> <p>If you have two tables that already have an established relationship, you can automatically use that relationship by just adding the columns we want from each table to the select statement.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">pop2008</span><span class="p">,</span> <span class="n">state_fact</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">abbreviation</span><span class="p">])</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="s">'sqlite:///census.db'</span><span class="p">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>

<span class="n">census</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'census'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">state_fact</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'state_fact'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Automatic Join
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">pop2008</span><span class="p">,</span> <span class="n">state_fact</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">abbreviation</span><span class="p">])</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>pop2008</th> <th>abbreviation</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>95012</td> <td>IL</td> </tr> <tr> <th>1</th> <td>95012</td> <td>NJ</td> </tr> <tr> <th>2</th> <td>95012</td> <td>ND</td> </tr> <tr> <th>3</th> <td>95012</td> <td>OR</td> </tr> <tr> <th>4</th> <td>95012</td> <td>DC</td> </tr> </tbody> </table></div> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Manual Join
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">pop2008</span><span class="p">,</span> <span class="n">state_fact</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">abbreviation</span><span class="p">]).</span><span class="n">join</span><span class="p">(</span><span class="n">state_fact</span><span class="p">,</span> <span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">state_fact</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT census.pop2008, state_fact.abbreviation 
FROM census JOIN state_fact ON census.state = state_fact.name
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>pop2008</th> <th>abbreviation</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>95012</td> <td>IL</td> </tr> <tr> <th>1</th> <td>91829</td> <td>IL</td> </tr> <tr> <th>2</th> <td>89547</td> <td>IL</td> </tr> <tr> <th>3</th> <td>90037</td> <td>IL</td> </tr> <tr> <th>4</th> <td>91111</td> <td>IL</td> </tr> </tbody> </table></div> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Manual Join
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">census</span><span class="p">,</span> <span class="n">state_fact</span><span class="p">])</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">census</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">state_fact</span><span class="p">,</span> <span class="n">census</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">state_fact</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>state</th> <th>sex</th> <th>age</th> <th>pop2000</th> <th>pop2008</th> <th>id</th> <th>name</th> <th>abbreviation</th> <th>country</th> <th>type</th> <th>...</th> <th>occupied</th> <th>notes</th> <th>fips_state</th> <th>assoc_press</th> <th>standard_federal_region</th> <th>census_region</th> <th>census_region_name</th> <th>census_division</th> <th>census_division_name</th> <th>circuit_court</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>Illinois</td> <td>M</td> <td>0</td> <td>89600</td> <td>95012</td> <td>13</td> <td>Illinois</td> <td>IL</td> <td>USA</td> <td>state</td> <td>...</td> <td>occupied</td> <td></td> <td>17</td> <td>Ill.</td> <td>V</td> <td>2</td> <td>Midwest</td> <td>3</td> <td>East North Central</td> <td>7</td> </tr> <tr> <th>1</th> <td>Illinois</td> <td>M</td> <td>1</td> <td>88445</td> <td>91829</td> <td>13</td> <td>Illinois</td> <td>IL</td> <td>USA</td> <td>state</td> <td>...</td> <td>occupied</td> <td></td> <td>17</td> <td>Ill.</td> <td>V</td> <td>2</td> <td>Midwest</td> <td>3</td> <td>East North Central</td> <td>7</td> </tr> <tr> <th>2</th> <td>Illinois</td> <td>M</td> <td>2</td> <td>88729</td> <td>89547</td> <td>13</td> <td>Illinois</td> <td>IL</td> <td>USA</td> <td>state</td> <td>...</td> <td>occupied</td> <td></td> <td>17</td> <td>Ill.</td> <td>V</td> <td>2</td> <td>Midwest</td> <td>3</td> <td>East North Central</td> <td>7</td> </tr> <tr> <th>3</th> <td>Illinois</td> <td>M</td> <td>3</td> <td>88868</td> <td>90037</td> <td>13</td> <td>Illinois</td> <td>IL</td> <td>USA</td> <td>state</td> <td>...</td> <td>occupied</td> <td></td> <td>17</td> <td>Ill.</td> <td>V</td> <td>2</td> <td>Midwest</td> <td>3</td> <td>East North Central</td> <td>7</td> </tr> <tr> <th>4</th> <td>Illinois</td> <td>M</td> <td>4</td> <td>91947</td> <td>91111</td> <td>13</td> <td>Illinois</td> <td>IL</td> <td>USA</td> <td>state</td> <td>...</td> <td>occupied</td> <td></td> <td>17</td> <td>Ill.</td> <td>V</td> <td>2</td> <td>Midwest</td> <td>3</td> <td>East North Central</td> <td>7</td> </tr> </tbody> </table></div> <p>5 rows × 22 columns</p> </div> <h2 id="creating-and-inserting-data-into-tables"> <a href="#creating-and-inserting-data-into-tables" class="anchor-heading" aria-labelledby="creating-and-inserting-data-into-tables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating and Inserting Data into Tables </h2> <p>By passing the database which is not present, to the engine then sqlalchemy automatically creates a new database.</p> <h3 id="creating-database-and-table"> <a href="#creating-database-and-table" class="anchor-heading" aria-labelledby="creating-database-and-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating Database and Table </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># delete the test database
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">test_db_name</span> <span class="o">=</span> <span class="s">'test.db'</span>

<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">test_db_name</span><span class="p">):</span> 
    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">test_db_name</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s">'sqlite:///</span><span class="si">{</span><span class="n">test_db_name</span><span class="si">}</span><span class="s">'</span><span class="p">)</span> <span class="c1">#Create test.db automatically
</span><span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>

<span class="n">emp</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'emp'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
              <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'Id'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">Integer</span><span class="p">()),</span>
              <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
              <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'salary'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">Float</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="mf">100.0</span><span class="p">),</span>
              <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">'active'</span><span class="p">,</span> <span class="n">db</span><span class="p">.</span><span class="n">Boolean</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
              <span class="p">)</span>

<span class="n">metadata</span><span class="p">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="c1">#Creates the table
</span></code></pre></div></div> <h3 id="inserting-data"> <a href="#inserting-data" class="anchor-heading" aria-labelledby="inserting-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Inserting Data </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Inserting record one by one
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">emp</span><span class="p">).</span><span class="n">values</span><span class="p">(</span><span class="n">Id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'naveen'</span><span class="p">,</span> <span class="n">salary</span><span class="o">=</span><span class="mf">60000.00</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> 
<span class="n">ResultProxy</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Inserting many records at ones
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">emp</span><span class="p">)</span> 
<span class="n">values_list</span> <span class="o">=</span> <span class="p">[{</span><span class="s">'Id'</span><span class="p">:</span><span class="s">'2'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span><span class="s">'ram'</span><span class="p">,</span> <span class="s">'salary'</span><span class="p">:</span><span class="mi">80000</span><span class="p">,</span> <span class="s">'active'</span><span class="p">:</span><span class="bp">False</span><span class="p">},</span>
               <span class="p">{</span><span class="s">'Id'</span><span class="p">:</span><span class="s">'3'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span><span class="s">'ramesh'</span><span class="p">,</span> <span class="s">'salary'</span><span class="p">:</span><span class="mi">70000</span><span class="p">,</span> <span class="s">'active'</span><span class="p">:</span><span class="bp">True</span><span class="p">}]</span>
<span class="n">ResultProxy</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values_list</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">emp</span><span class="p">])).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>Id</th> <th>name</th> <th>salary</th> <th>active</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>1</td> <td>naveen</td> <td>60000.0</td> <td>True</td> </tr> <tr> <th>1</th> <td>2</td> <td>ram</td> <td>80000.0</td> <td>False</td> </tr> <tr> <th>2</th> <td>3</td> <td>ramesh</td> <td>70000.0</td> <td>True</td> </tr> </tbody> </table></div> </div> <h3 id="updating-data-in-databases"> <a href="#updating-data-in-databases" class="anchor-heading" aria-labelledby="updating-data-in-databases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Updating data in Databases </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">table_name</span><span class="p">).</span><span class="n">values</span><span class="p">(</span><span class="n">attribute</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">).</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s">'sqlite:///</span><span class="si">{</span><span class="n">test_db_name</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">emp</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'emp'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">emp</span><span class="p">])).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>Id</th> <th>name</th> <th>salary</th> <th>active</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>1</td> <td>naveen</td> <td>60000.0</td> <td>True</td> </tr> <tr> <th>1</th> <td>2</td> <td>ram</td> <td>80000.0</td> <td>False</td> </tr> <tr> <th>2</th> <td>3</td> <td>ramesh</td> <td>70000.0</td> <td>True</td> </tr> </tbody> </table></div> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Build a statement to update the salary to 100000
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">emp</span><span class="p">).</span><span class="n">values</span><span class="p">(</span><span class="n">salary</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">Id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">emp</span><span class="p">])).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>Id</th> <th>name</th> <th>salary</th> <th>active</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>1</td> <td>naveen</td> <td>100000.0</td> <td>True</td> </tr> <tr> <th>1</th> <td>2</td> <td>ram</td> <td>80000.0</td> <td>False</td> </tr> <tr> <th>2</th> <td>3</td> <td>ramesh</td> <td>70000.0</td> <td>True</td> </tr> </tbody> </table></div> </div> <h3 id="delete-table"> <a href="#delete-table" class="anchor-heading" aria-labelledby="delete-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Delete Table </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">table_name</span><span class="p">).</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s">'sqlite:///</span><span class="si">{</span><span class="n">test_db_name</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">emp</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'emp'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">emp</span><span class="p">])).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>Id</th> <th>name</th> <th>salary</th> <th>active</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>1</td> <td>naveen</td> <td>100000.0</td> <td>True</td> </tr> <tr> <th>1</th> <td>2</td> <td>ram</td> <td>80000.0</td> <td>False</td> </tr> <tr> <th>2</th> <td>3</td> <td>ramesh</td> <td>70000.0</td> <td>True</td> </tr> </tbody> </table></div> </div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Build a statement to delete where salary &lt; 100000
</span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">emp</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">emp</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results</span> <span class="o">=</span> <span class="n">connection</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">select</span><span class="p">([</span><span class="n">emp</span><span class="p">])).</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <div class="table-wrapper"><table border="1" class="dataframe"> <thead> <tr style="text-align: right;"> <th></th> <th>Id</th> <th>name</th> <th>salary</th> <th>active</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>1</td> <td>naveen</td> <td>100000.0</td> <td>True</td> </tr> </tbody> </table></div> </div> <h3 id="dropping-a-table"> <a href="#dropping-a-table" class="anchor-heading" aria-labelledby="dropping-a-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dropping a Table </h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">table_name</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="c1">#drops a single table
</span>
<span class="n">metadata</span><span class="p">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="c1">#drops all the tables in the database
</span></code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s">'sqlite:///</span><span class="si">{</span><span class="n">test_db_name</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">MetaData</span><span class="p">()</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># drop a table
</span><span class="n">emp</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">'emp'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">autoload_with</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">emp</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># drop all tables
</span><span class="n">metadata</span><span class="p">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
